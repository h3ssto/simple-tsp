(function(){const M=document.createElement("link").relList;if(M&&M.supports&&M.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))B(p);new MutationObserver(p=>{for(const h of p)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&B(o)}).observe(document,{childList:!0,subtree:!0});function $(p){const h={};return p.integrity&&(h.integrity=p.integrity),p.referrerPolicy&&(h.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?h.credentials="include":p.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function B(p){if(p.ep)return;p.ep=!0;const h=$(p);fetch(p.href,h)}})();document.addEventListener("DOMContentLoaded",function(){const h=d3.select("#tsp-vis").append("svg").attr("width",1e3).attr("height",1e3).style("overflow","visible");d3.json("/example.json").then(function(o){const j=o.map(e=>e.latitude),k=o.map(e=>e.longitude),D=Math.min(...j),z=Math.max(...j),S=Math.min(...k),H=Math.max(...k);function c(e){const a=40+(e.longitude-S)/(H-S)*920,l=960-(e.latitude-D)/(z-D)*(1e3-2*40);return{x:a,y:l}}const W=h.append("g").attr("class","edges");for(let e=0;e<o.length;e++)for(let a=e+1;a<o.length;a++){const l=c(o[e]),r=c(o[a]);W.append("line").attr("x1",l.x).attr("y1",l.y).attr("x2",r.x).attr("y2",r.y).attr("class","tsp-edge")}const w=h.insert("g",":first-child").attr("class","path-edges"),N=h.append("g").attr("class","current-edges"),y=h.append("g").attr("class","hover-effects");function b(e,a){const l=e.x-a.x,r=e.y-a.y;return Math.sqrt(l*l+r*r)}function I(){if(N.selectAll("*").remove(),t.length===0)return;const e=t[t.length-1],a=c(o[e]);let l=[];for(let r=0;r<o.length;r++){if(t.includes(r)||r===e)continue;const n=c(o[r]),s=b(a,n);l.push({idx:r,target:n,dist:s})}l.sort((r,n)=>r.dist-n.dist),l=l.slice(0,3);for(const{idx:r,target:n,dist:s}of l){N.append("line").attr("x1",a.x).attr("y1",a.y).attr("x2",n.x).attr("y2",n.y).attr("data-target-idx",r);const i=(a.x+n.x)/2,d=(a.y+n.y)/2;let u=Math.atan2(n.y-a.y,n.x-a.x)*180/Math.PI;(u>90||u<-90)&&(u+=180);const g=s.toFixed(1),f=g.length*8+6,x=16,m=N.append("g").attr("transform",`translate(${i},${d-6}) rotate(${u})`).attr("data-target-idx",r);m.append("rect").attr("class","edge-label-bg").attr("x",-f/2).attr("y",-x/2).attr("width",f).attr("height",x),m.append("text").attr("class","edge-label").attr("y",4).text(g)}}const O=h.selectAll("circle").data(o).enter().append("circle").attr("class","city-node").attr("cx",e=>c(e).x).attr("cy",e=>c(e).y).attr("r",10);let t=[];function E(){const e=document.getElementById("route-length");if(!t.length){e.textContent="";return}let a=0;for(let l=0;l<t.length-1;l++){const r=c(o[t[l]]),n=c(o[t[l+1]]);a+=b(r,n)}e.textContent=`Route length: ${a.toFixed(1)}`}function C(){const e=document.getElementById("btn-nn-complete"),a=document.getElementById("btn-random-complete"),l=document.getElementById("btn-2opt"),r=t.length>=1,n=t.length===o.length+1;e.disabled=!r||n,a.disabled=!r||n,l.disabled=!n}function T(){const e=document.getElementById("start-hint");t.length===0?(e.textContent="Click on a city to start building your route!",e.classList.remove("hide")):t.length===1?(e.textContent="Add another city to the route by clicking it.",e.classList.remove("hide")):t.length===2?(e.textContent="Right-click anywhere to undo the last step.",e.classList.remove("hide")):e.classList.add("hide")}function P(){w.selectAll("line").remove();for(let e=0;e<t.length-1;e++){const a=c(o[t[e]]),l=c(o[t[e+1]]);w.append("line").attr("x1",a.x).attr("y1",a.y).attr("x2",l.x).attr("y2",l.y).attr("class","path-edge")}h.selectAll("circle.city-node").classed("selected",(e,a)=>t.includes(a)).classed("can-complete",!1),t.length===o.length&&t[0]!==t[t.length-1]&&h.selectAll("circle.city-node").filter((e,a)=>a===t[0]).classed("can-complete",!0),I(),E(),C(),T()}O.on("click",function(e,a){const l=o.indexOf(a);t.length===0?t.push(l):t.includes(l)?t.length===o.length&&l===t[0]&&t[0]!==t[t.length-1]&&t.push(l):t.push(l),P()}),O.on("mouseenter",function(e,a){const l=o.indexOf(a);if(t.length===0||t.includes(l))return;const r=t[t.length-1],n=c(o[r]),s=c(a),i=b(n,s);y.append("line").attr("class","hover-edge").attr("x1",n.x).attr("y1",n.y).attr("x2",s.x).attr("y2",s.y);const d=(n.x+s.x)/2,u=(n.y+s.y)/2;let g=Math.atan2(s.y-n.y,s.x-n.x)*180/Math.PI;(g>90||g<-90)&&(g+=180);const f=i.toFixed(1),x=f.length*8+12,m=20,A=y.append("g").attr("transform",`translate(${d},${u-8}) rotate(${g})`);A.append("rect").attr("class","hover-label-bg").attr("x",-x/2).attr("y",-m/2).attr("width",x).attr("height",m),A.append("text").attr("class","hover-label").attr("y",6).text(f)}),O.on("mouseleave",function(e,a){y.selectAll("*").remove()});const v=o.map((e,a)=>{const l=c(e);return{index:a,name:e.name,x:l.x,y:l.y-15,fx:null,fy:null}}),L=o.map((e,a)=>{const l=c(e);return{index:a,x:l.x,y:l.y}}),X=v.map((e,a)=>({source:a,target:a,strength:1}));function Y(e){for(let a=0;a<v.length;a++){const l=v[a];for(let r=0;r<L.length;r++){if(a===r)continue;const n=L[r];let s=l.x-n.x,i=l.y-n.y,d=Math.sqrt(s*s+i*i);const u=28;if(d<u&&d>.01){const g=(u-d)*.5*e;s/=d,i/=d,l.x+=s*g,l.y+=i*g}}}}const V=d3.forceSimulation(v).force("link",d3.forceLink(X).distance(25).strength(1).iterations(10)).force("collide",d3.forceCollide(18)).force("x",d3.forceX((e,a)=>L[a].x).strength(.2)).force("y",d3.forceY((e,a)=>L[a].y-15).strength(.2)).alphaDecay(.03).on("tick",()=>Y(.5));for(let e=0;e<100;e++)V.tick();for(let e=0;e<v.length;e++){const a=v[e];for(let l=0;l<L.length;l++){const r=L[l];let n=a.x-r.x,s=a.y-r.y,i=Math.sqrt(n*n+s*s);const d=28;if(i<d&&i>.01){const u=d-i+1;n/=i,s/=i,a.x+=n*u,a.y+=s*u}}}const G=h.selectAll("g.city-label-group").data(v).enter().append("g").attr("class","city-label-group").attr("transform",e=>`translate(${e.x},${e.y})`);G.append("rect").attr("class","city-label-bg").attr("x",function(e){return-((e.name.length*8+8)/2)}).attr("y",-12).attr("width",e=>e.name.length*8+8).attr("height",20),G.append("text").attr("class","city-label").attr("y",0).text(e=>e.name);async function K(){const e=document.getElementById("btn-nn-complete");if(e.disabled=!0,!t.length||t.length===o.length+1){e.disabled=!1,C();return}let a=new Set(t),l=t[t.length-1];for(;a.size<o.length;){let r=1/0,n=-1;const s=c(o[l]);for(let d=0;d<o.length;d++){if(a.has(d))continue;const u=c(o[d]),g=b(s,u);g<r&&(r=g,n=d)}if(n===-1)break;const i=c(o[n]);w.append("line").attr("x1",s.x).attr("y1",s.y).attr("x2",i.x).attr("y2",i.y).attr("class","autocompleted-edge"),h.selectAll("circle.city-node").filter((d,u)=>u===n).classed("autocompleted-node",!0),t.push(n),a.add(n),l=n,E(),I(),await new Promise(d=>setTimeout(d,500))}if(t.length&&t[0]!==t[t.length-1]){const r=c(o[t[t.length-1]]),n=c(o[t[0]]);w.append("line").attr("x1",r.x).attr("y1",r.y).attr("x2",n.x).attr("y2",n.y).attr("class","autocompleted-edge"),t.push(t[0]),E(),I(),await new Promise(s=>setTimeout(s,500))}h.selectAll("circle.city-node").classed("autocompleted-node",!1),P(),e.disabled=!1,C()}document.getElementById("btn-nn-complete").addEventListener("click",K),C(),T();async function J(){const e=document.getElementById("btn-2opt");if(e.disabled=!0,t.length<4){e.disabled=!1;return}let a=!0;for(;a;){a=!1;let l=0,r=null;for(let n=0;n<t.length-2;n++)for(let s=n+2;s<t.length;s++){const i=c(o[t[n]]),d=c(o[t[n+1]]),u=c(o[t[s]]),g=c(o[t[(s+1)%t.length]]),f=b(i,d)+b(u,g),x=b(i,u)+b(d,g),m=f-x;m>l&&(l=m,r={i:n,j:s})}if(r&&l>.1){const{i:n,j:s}=r,i=c(o[t[n]]),d=c(o[t[n+1]]),u=c(o[t[s]]),g=c(o[t[(s+1)%t.length]]);y.append("line").attr("class","swap-remove").attr("x1",i.x).attr("y1",i.y).attr("x2",d.x).attr("y2",d.y),y.append("line").attr("class","swap-remove").attr("x1",u.x).attr("y1",u.y).attr("x2",g.x).attr("y2",g.y),y.append("line").attr("class","swap-add").attr("x1",i.x).attr("y1",i.y).attr("x2",u.x).attr("y2",u.y),y.append("line").attr("class","swap-add").attr("x1",d.x).attr("y1",d.y).attr("x2",g.x).attr("y2",g.y),await new Promise(R=>setTimeout(R,1e3)),y.selectAll("*").remove();const f=t.slice(n+1,s+1).reverse();t.splice(n+1,s-n,...f),P();const x=c(o[t[n]]),m=c(o[t[n+1]]),A=c(o[t[s]]),q=c(o[t[(s+1)%t.length]]);y.append("line").attr("class","swap-result").attr("x1",x.x).attr("y1",x.y).attr("x2",m.x).attr("y2",m.y),y.append("line").attr("class","swap-result").attr("x1",A.x).attr("y1",A.y).attr("x2",q.x).attr("y2",q.y),await new Promise(R=>setTimeout(R,1e3)),a=!0}}e.disabled=!0,y.selectAll("*").remove()}document.getElementById("btn-2opt").addEventListener("click",J);async function Q(){const e=document.getElementById("btn-random-complete");if(e.disabled=!0,!t.length||t.length===o.length+1){e.disabled=!1;return}let a=new Set(t),l=t[t.length-1];for(;a.size<o.length;){const r=[];for(let d=0;d<o.length;d++)a.has(d)||r.push(d);const n=r[Math.floor(Math.random()*r.length)],s=c(o[l]),i=c(o[n]);w.append("line").attr("x1",s.x).attr("y1",s.y).attr("x2",i.x).attr("y2",i.y).attr("class","autocompleted-edge"),h.selectAll("circle.city-node").filter((d,u)=>u===n).classed("autocompleted-node",!0),t.push(n),a.add(n),l=n,E(),I(),await new Promise(d=>setTimeout(d,250))}if(t.length&&t[0]!==t[t.length-1]){const r=c(o[t[t.length-1]]),n=c(o[t[0]]);w.append("line").attr("x1",r.x).attr("y1",r.y).attr("x2",n.x).attr("y2",n.y).attr("class","autocompleted-edge"),t.push(t[0]),E(),I(),await new Promise(s=>setTimeout(s,250))}h.selectAll("circle.city-node").classed("autocompleted-node",!1),P(),e.disabled=!1}document.getElementById("btn-random-complete").addEventListener("click",Q),document.addEventListener("contextmenu",function(e){e.preventDefault(),t.length>0&&(t.pop(),P())})})});
